# Data Model: Embedded RAG Chatbot – Part 1: Data Ingestion & Embeddings

**Feature**: 010-content-ingestion-pipeline
**Date**: 2025-12-25

## ContentSegment

A chunk of text from the textbook content (500-800 tokens) with associated metadata.

**Fields**:
- `id` (string): Unique identifier for the content segment
- `content` (text): The actual text content (500-800 tokens)
- `module` (string): The module name from the book structure
- `chapter` (string): The chapter name from the book structure
- `section` (string): The section name from the book structure
- `page_url` (string): The URL path for the page containing this content
- `token_count` (integer): Number of tokens in the content segment
- `hash` (string): Hash of the content for change detection
- `created_at` (timestamp): When this segment was created
- `updated_at` (timestamp): When this segment was last updated

**Validation Rules**:
- Content must be between 500-800 tokens
- Module, chapter, and section must not be empty
- Page URL must be a valid path format

## Embedding

Vector representation of a content segment generated by Cohere Embed.

**Fields**:
- `id` (string): Unique identifier for the embedding
- `content_segment_id` (string): Foreign key reference to ContentSegment
- `vector` (array[float]): The embedding vector from Cohere API
- `model_name` (string): Name of the embedding model used (e.g., "embed-english-v3.0")
- `created_at` (timestamp): When this embedding was generated

**Validation Rules**:
- Vector must not be empty
- Content segment ID must reference an existing ContentSegment
- Model name must be a valid Cohere embedding model

## Metadata

Structural information about the content including module, chapter, section, and page URL.

**Fields**:
- `id` (string): Unique identifier for the metadata record
- `content_segment_id` (string): Foreign key reference to ContentSegment
- `module` (string): The module name from the book structure
- `chapter` (string): The chapter name from the book structure
- `section` (string): The section name from the book structure
- `page_url` (string): The URL path for the page containing this content
- `source_file_path` (string): Path to the original markdown file
- `source_file_hash` (string): Hash of the original markdown file for change detection
- `created_at` (timestamp): When this metadata was created
- `updated_at` (timestamp): When this metadata was last updated

**Validation Rules**:
- Module, chapter, and section must not be empty
- Page URL must be a valid path format
- Source file path must be a valid path format

## IngestionLog

Record of ingestion activities including timestamps, status, and error information.

**Fields**:
- `id` (string): Unique identifier for the log entry
- `run_id` (string): Identifier for the specific ingestion run
- `source_file_path` (string): Path to the file being processed
- `status` (string): Status of the processing (e.g., "success", "error", "skipped")
- `error_message` (text, optional): Error message if processing failed
- `content_segments_created` (integer): Number of content segments created
- `start_time` (timestamp): When processing started
- `end_time` (timestamp): When processing ended
- `duration_ms` (integer): Duration of processing in milliseconds
- `created_at` (timestamp): When this log entry was created

**Validation Rules**:
- Status must be one of: "success", "error", "skipped"
- Duration must be non-negative
- Run ID must be consistent for all logs in the same ingestion run

## Relationships

- ContentSegment 1 ←→ * Embedding (one-to-many)
- ContentSegment 1 ←→ 1 Metadata (one-to-one)
- IngestionLog * ←→ 1 Source File (many-to-one based on file path)